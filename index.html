<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NowNow CS Chat Tags Finder</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@vitalets/google-translate-api/browser.min.js"></script>
  <style>
    body { font-family: 'Helvetica Neue', sans-serif; padding: 20px; background: #fff9f3; color: #333; }
    h2 { font-size: 2.4rem; margin-bottom: 10px; color: #2b2b2b; }
    p { font-size: 1.1rem; margin-bottom: 20px; color: #4d4d4d; }
    select, button { margin: 10px 0; padding: 12px; width: 320px; font-size: 1rem; border: 1px solid #ffce00; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); background-color: #fff7e6; color: #333; }
    .language-toggle { margin-bottom: 20px; }
    .tag-card { background: #ffffff; border-radius: 20px; padding: 22px; margin-bottom: 18px; box-shadow: 0 6px 14px rgba(0,0,0,0.05); transition: transform 0.2s; border: 1px solid #f4f4f4; }
    .tag-card:hover { transform: translateY(-4px); }
    .tag-title { font-weight: 600; font-size: 1.3em; margin-bottom: 10px; color: #2d2d2d; }
    .copy-btn { margin-top: 12px; cursor: pointer; background-color: #ffce00; color: #000; padding: 10px 16px; border-radius: 8px; border: none; font-size: 1rem; transition: background-color 0.2s, box-shadow 0.2s; }
    .copy-btn:hover { background-color: #ffdf4d; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
    #tagsContainer { margin-top: 35px; }
  </style>
</head>
<body>

<h2>Agent Tag Finder</h2>
<div class="language-toggle">
  <label>Select Language: </label>
  <select id="languageSwitcher">
    <option value="en">English</option>
    <option value="ar">Arabic</option>
  </select>
</div>

<p>Select a group or view all tags at once. Click 'Copy Tag' to copy easily.</p>

<select id="categorySelector">
  <option value="">-- Select Group --</option>
  <option value="ALL_TAGS">View All Tags</option>
</select>

<div id="tagsContainer"></div>

<script>
  const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRxUHKTNNGidfBRrpme1pUvysor1s-jZ27Zk16acjq62djh-ZTTght15r6uzBIlyZdWc55P8Uu8JDma/pub?gid=1849319999&single=true&output=csv';
  let tagData = [];
  let currentLang = 'en';

  fetch(sheetURL)
    .then(response => response.text())
    .then(csvText => {
      const parsed = Papa.parse(csvText, { header: true });
      tagData = parsed.data;
      populateCategories();
    });

  document.getElementById('languageSwitcher').addEventListener('change', function() {
    currentLang = this.value;
    populateCategories();
  });

  function populateCategories() {
    const selector = document.getElementById('categorySelector');
    selector.innerHTML = '<option value="">-- Select Group --</option><option value="ALL_TAGS">View All Tags</option>';

    const categories = [...new Set(tagData.map(row => row.Group).filter(Boolean))];
    categories.forEach(async category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = currentLang === 'ar' ? await translateText(category) : category;
      selector.appendChild(option);
    });
  }

  document.getElementById('categorySelector').addEventListener('change', function() {
    const selectedCategory = this.value;
    if (selectedCategory === 'ALL_TAGS') {
      displayTags(null, true);
    } else {
      displayTags(selectedCategory);
    }
  });

  async function displayTags(category, showAll = false) {
    const container = document.getElementById('tagsContainer');
    container.innerHTML = '';

    const filtered = showAll ? tagData.filter(row => row.Tag && row.Description) : tagData.filter(row => row.Group === category);

    for (const tag of filtered) {
      const card = document.createElement('div');
      card.className = 'tag-card';

      const description = currentLang === 'ar' ? await translateText(tag.Description) : tag.Description;

      card.innerHTML = `
        <div class="tag-title">${tag.Tag}</div>
        <div>${description}</div>
        <button class="copy-btn" onclick="copyToClipboard('${tag.Tag}')">Copy Tag</button>
      `;

      container.appendChild(card);
    }
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => alert('Tag copied: ' + text));
  }

  async function translateText(text) {
    try {
      const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ar&dt=t&q=${encodeURIComponent(text)}`);
      const result = await response.json();
      return result[0][0][0];
    } catch (error) {
      return text; // fallback to English if translation fails
    }
  }
</script>

</body>
</html>
